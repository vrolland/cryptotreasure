# CryptoTreasures

<!--
Crypto treasures are live on testnet: [Crypto Treasure website](https://crypto-treasures.com/) 
-->

Bug bounty program on [immunefi.com](https://immunefi.com/bounty/cryptotreasures/) is closed for now.

[![](https://mermaid.ink/img/eyJjb2RlIjoiZ3JhcGggVERcbiAgICBcbiAgICBDb250ZXh0Ojo6b3ogLS0-IElCb3hcbiAgICBJQm94Ojo6aW50ZXJmYWNlIC0tPiBCb3hQcm94eVxuICAgIElCb3ggLS0-IEJveEJhc2VcbiAgICBCb3hTdG9yYWdlOjo6YWJzdHJhY3QgLS0-IEJveFByb3h5XG4gICAgQm94U3RvcmFnZSAtLT4gQm94QmFzZVxuICAgIEJveFByb3h5Ojo6YWJzdHJhY3QgLS0-fERlbGVnYXRlfCBCb3hCYXNlOjo6ZGVwbG95ZWRcbiAgICBCb3hQcm94eSAtLT4gQm94V2l0aFRpbWVMb2NrXG4gIFxuICAgIEVSQzcyMTo6Om96IC0tPiBFUkM3MjFUeXBlZFxuICAgIEVSQzcyMVR5cGVkOjo6YWJzdHJhY3QgLS0-IEVSQzcyMVR5cGVkTWludEJ5TG9ja2luZ0VSQzIwXG4gIFxuICAgIEJveFdpdGhUaW1lTG9jazo6OmFic3RyYWN0IC0tPiBDcnlwdG9UcmVhc3VyZTo6OmRlcGxveWVkXG5cbiAgICBFUkM3MjFUeXBlZE1pbnRCeUxvY2tpbmdFUkMyMDo6OmFic3RyYWN0IC0tPiBDcnlwdG9UcmVhc3VyZVxuICAgIEFjY2Vzc0NvbnRyb2w6OjpveiAtLT4gQ3J5cHRvVHJlYXN1cmVcblxuICAgIGNsYXNzRGVmIG96IGZpbGw6d2hpdGUsIHN0cm9rZTpncmV5O1xuICAgIGNsYXNzRGVmIGFic3RyYWN0IGZpbGw6I2Q2ZWFmOCwgc3Ryb2tlOiNkNmVhZjggO1xuICAgIGNsYXNzRGVmIGRlcGxveWVkIGZpbGw6ICAjMjdhZTYwLCBzdHJva2U6Z3JlZW4gIDtcbiAgICBjbGFzc0RlZiBpbnRlcmZhY2UgZmlsbDogICNmZmZmYTIsIHN0cm9rZTp5ZWxsb3cgIDsiLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9LCJ1cGRhdGVFZGl0b3IiOmZhbHNlLCJhdXRvU3luYyI6dHJ1ZSwidXBkYXRlRGlhZ3JhbSI6ZmFsc2V9)](https://mermaid-js.github.io/mermaid-live-editor/edit/#eyJjb2RlIjoiZ3JhcGggVERcbiAgICBcbiAgICBDb250ZXh0Ojo6b3ogLS0-IElCb3hcbiAgICBJQm94Ojo6aW50ZXJmYWNlIC0tPiBCb3hQcm94eVxuICAgIElCb3ggLS0-IEJveEJhc2VcbiAgICBCb3hTdG9yYWdlOjo6YWJzdHJhY3QgLS0-IEJveFByb3h5XG4gICAgQm94U3RvcmFnZSAtLT4gQm94QmFzZVxuICAgIEJveFByb3h5Ojo6YWJzdHJhY3QgLS0-fERlbGVnYXRlfCBCb3hCYXNlOjo6ZGVwbG95ZWRcbiAgICBCb3hQcm94eSAtLT4gQm94V2l0aFRpbWVMb2NrXG4gIFxuICAgIEVSQzcyMTo6Om96IC0tPiBFUkM3MjFUeXBlZFxuICAgIEVSQzcyMVR5cGVkOjo6YWJzdHJhY3QgLS0-IEVSQzcyMVR5cGVkTWludEJ5TG9ja2luZ0VSQzIwXG4gIFxuICAgIEJveFdpdGhUaW1lTG9jazo6OmFic3RyYWN0IC0tPiBDcnlwdG9UcmVhc3VyZTo6OmRlcGxveWVkXG5cbiAgICBFUkM3MjFUeXBlZE1pbnRCeUxvY2tpbmdFUkMyMDo6OmFic3RyYWN0IC0tPiBDcnlwdG9UcmVhc3VyZVxuICAgIEFjY2Vzc0NvbnRyb2w6OjpveiAtLT4gQ3J5cHRvVHJlYXN1cmVcblxuICAgIGNsYXNzRGVmIG96IGZpbGw6d2hpdGUsIHN0cm9rZTpncmV5O1xuICAgIGNsYXNzRGVmIGFic3RyYWN0IGZpbGw6I2Q2ZWFmOCwgc3Ryb2tlOiNkNmVhZjggO1xuICAgIGNsYXNzRGVmIGRlcGxveWVkIGZpbGw6ICAjMjdhZTYwLCBzdHJva2U6Z3JlZW4gIDtcbiAgICBjbGFzc0RlZiBpbnRlcmZhY2UgZmlsbDogICNmZmZmYTIsIHN0cm9rZTp5ZWxsb3cgIDsiLCJtZXJtYWlkIjoie1xuICBcInRoZW1lXCI6IFwiZGVmYXVsdFwiXG59IiwidXBkYXRlRWRpdG9yIjpmYWxzZSwiYXV0b1N5bmMiOnRydWUsInVwZGF0ZURpYWdyYW0iOmZhbHNlfQ)



# CryptoTreasure.sol

CryptoTreasure is an ERC721 token with additional features.
It has the capacity of a box and is able to store other tokens (ETH, ERC20, ERC721 & ERC1155). The box has an access management system (lock and restrictions).
It also has a "type" which manages an ERC20 locking system to mint a crypto treasure.
A type defines:

- how many tokens of this type can be minted
- the erc token and amount to be locked
- the timestamp from which you can mint it

The locked erc20 tokens can be released by "destroying" the crypto treasure.

# Box contracts

## BoxStorage.sol

Abstract contract declaring events and storage to handle boxes.
Used by `BoxBase.sol` and `BoxBase.sol`.

## BoxExternal.sol

Box with public functions to store, withdraw, transferBetweenBoxes and destroy.
This contract `delegateCall` the contract BoxBase.
This contract forbid reception of ERC115 and ERC721 except if the operator is this contact.
Don't directly send ERC20 to this contract!

## BoxBase.sol

Box with functions to store, withdraw, transferBetweenBoxes and destroy.
This contract is meant to be delegateCalled by a contract inheriting from BoxExternal.
This contract forbid reception of ERC115 and ERC721.
Don't directly send ERC20 to this contract!

## BoxWithTimeLock.sol

Box with a time lock.
A locked box prevent withdrawing, storing or destroying until the end of the lock.

# ERC721 contracts

## ERC721Typed.sol

Abstract contract to type ERC721.
Every token has a type with optional data.

## ERC721TypedMintByLockingERC20.sol

Allow the ERC721 to be minted from locking erc20s.
Every type requires a specific amount of a specific erc20.
To unlock the erc20 tokens locked after minting, the internal function \_unlockMint() must be called.

# Utils

## Bytes.sol

Internal library to extract data from Bytes.

# Developers

```
forge install OpenZeppelin/openzeppelin-contracts
forge build
forge test
```